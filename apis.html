<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.54">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Leon Yin">
<meta name="dcterms.date" content="2023-02-24">
<meta name="keywords" content="data collection, hidden api, undocumented api, web scraping, api">
<meta name="description" content="Introduction, case studies, and exercises for finding and using hidden and undocumented APIs.">

<title>Finding Undocumented APIs – Inspect Element</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./browser_automation.html" rel="next">
<link href="./build-your-own-datasets.html" rel="prev">
<link href="./assets/favicon/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<meta property="og:title" content="Finding Undocumented APIs">
<meta property="og:description" content="Introduction, case studies, and exercises for finding and using undocumented APIs hidden in plain sight.">
<meta property="og:image" content="https://inspectelement.org/assets/inspect-element-logo.jpg">
<meta property="og:site_name" content="Inspect Element">
<meta property="og:image:alt" content="The inspect element logo">
<meta property="og:locale" content="us_EN">
<meta name="twitter:title" content="Finding Undocumented APIs">
<meta name="twitter:description" content="Introduction, case studies, and exercises for finding and using undocumented APIs hidden in plain sight.">
<meta name="twitter:image" content="https://inspectelement.org/assets/inspect-element-logo.jpg">
<meta name="twitter:image:alt" content="The inspect element logo">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./build-your-own-datasets.html">Build your own datasets</a></li><li class="breadcrumb-item"><a href="./apis.html"><span class="chapter-title">Undocumented APIs</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Inspect Element</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/yinleon/inspect-element" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./start.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Planning investigations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./checklist.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Checklist</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./build-your-own-datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Build your own datasets</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./apis.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Undocumented APIs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./browser_automation.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Browser automation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./best-practices-data-collection.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Best practices</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#intro" id="toc-intro" class="nav-link active" data-scroll-target="#intro">Intro</a>
  <ul class="collapse">
  <li><a href="#what-is-an-a-p-i" id="toc-what-is-an-a-p-i" class="nav-link" data-scroll-target="#what-is-an-a-p-i">What is an A-P-I?</a></li>
  <li><a href="#a-key-tool-for-investigations" id="toc-a-key-tool-for-investigations" class="nav-link" data-scroll-target="#a-key-tool-for-investigations">A key tool for investigations</a></li>
  <li><a href="#documented-apis" id="toc-documented-apis" class="nav-link" data-scroll-target="#documented-apis">Documented APIs</a>
  <ul class="collapse">
  <li><a href="#how-have-documented-apis-been-used" id="toc-how-have-documented-apis-been-used" class="nav-link" data-scroll-target="#how-have-documented-apis-been-used">How have Documented APIs been used?</a></li>
  </ul></li>
  <li><a href="#undocumented-apis" id="toc-undocumented-apis" class="nav-link" data-scroll-target="#undocumented-apis">Undocumented APIs</a></li>
  </ul></li>
  <li><a href="#case-studies" id="toc-case-studies" class="nav-link" data-scroll-target="#case-studies">Case Studies</a>
  <ul class="collapse">
  <li><a href="#how-have-undocumented-apis-been-used" id="toc-how-have-undocumented-apis-been-used" class="nav-link" data-scroll-target="#how-have-undocumented-apis-been-used"><em>How have undocumented APIs been used?</em></a></li>
  <li><a href="#case-study-on-richness-googles-blocklist-for-youtube-advertisers" id="toc-case-study-on-richness-googles-blocklist-for-youtube-advertisers" class="nav-link" data-scroll-target="#case-study-on-richness-googles-blocklist-for-youtube-advertisers">Case study on richness: Google’s blocklist for YouTube advertisers</a></li>
  <li><a href="#case-study-on-reliability-amazon-branded-products" id="toc-case-study-on-reliability-amazon-branded-products" class="nav-link" data-scroll-target="#case-study-on-reliability-amazon-branded-products">Case study on reliability: Amazon branded products</a></li>
  <li><a href="#case-study-on-scalability-collecting-internet-plans" id="toc-case-study-on-scalability-collecting-internet-plans" class="nav-link" data-scroll-target="#case-study-on-scalability-collecting-internet-plans">Case study on scalability: collecting Internet Plans</a></li>
  </ul></li>
  <li><a href="#tutorial" id="toc-tutorial" class="nav-link" data-scroll-target="#tutorial">Tutorial</a>
  <ul class="collapse">
  <li><a href="#how-to-find-and-use-undocumented-apis" id="toc-how-to-find-and-use-undocumented-apis" class="nav-link" data-scroll-target="#how-to-find-and-use-undocumented-apis"><em>How to find and use undocumented APIs</em></a>
  <ul class="collapse">
  <li><a href="#first-open-the-developer-console." id="toc-first-open-the-developer-console." class="nav-link" data-scroll-target="#first-open-the-developer-console.">1. First open the developer console.</a></li>
  <li><a href="#click-the-network-tab." id="toc-click-the-network-tab." class="nav-link" data-scroll-target="#click-the-network-tab.">2. Click the “Network” tab.</a></li>
  <li><a href="#filter-requests-by-fetchxhr" id="toc-filter-requests-by-fetchxhr" class="nav-link" data-scroll-target="#filter-requests-by-fetchxhr">3. Filter requests by fetch/XHR</a></li>
  <li><a href="#analyze-the-response" id="toc-analyze-the-response" class="nav-link" data-scroll-target="#analyze-the-response">4. Analyze the response</a></li>
  <li><a href="#copy-as-curl" id="toc-copy-as-curl" class="nav-link" data-scroll-target="#copy-as-curl">5. Copy as cURL</a></li>
  <li><a href="#curl-to-requests" id="toc-curl-to-requests" class="nav-link" data-scroll-target="#curl-to-requests">6. Curl to requests</a></li>
  <li><a href="#strip-it-down" id="toc-strip-it-down" class="nav-link" data-scroll-target="#strip-it-down">7. Strip it down</a></li>
  <li><a href="#recycle-and-reuse" id="toc-recycle-and-reuse" class="nav-link" data-scroll-target="#recycle-and-reuse">8. Recycle and reuse</a></li>
  </ul></li>
  <li><a href="#do-it-yourself" id="toc-do-it-yourself" class="nav-link" data-scroll-target="#do-it-yourself">Do it yourself</a>
  <ul class="collapse">
  <li><a href="#for-advanced-usage" id="toc-for-advanced-usage" class="nav-link" data-scroll-target="#for-advanced-usage">For advanced usage…</a></li>
  </ul></li>
  <li><a href="#predetermined-prompts" id="toc-predetermined-prompts" class="nav-link" data-scroll-target="#predetermined-prompts">Predetermined prompts</a></li>
  <li><a href="#homework-assignment" id="toc-homework-assignment" class="nav-link" data-scroll-target="#homework-assignment">Homework assignment</a></li>
  </ul></li>
  <li><a href="#related-readings" id="toc-related-readings" class="nav-link" data-scroll-target="#related-readings">Related readings</a>
  <ul class="collapse">
  <li><a href="#artifacts" id="toc-artifacts" class="nav-link" data-scroll-target="#artifacts">Artifacts</a></li>
  </ul></li>
  <li><a href="#citation" id="toc-citation" class="nav-link" data-scroll-target="#citation">Citation</a>
  <ul class="collapse">
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements">Acknowledgements</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.dev/yinleon/inspect-element/blob/main/apis.ipynb" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./build-your-own-datasets.html">Build your own datasets</a></li><li class="breadcrumb-item"><a href="./apis.html"><span class="chapter-title">Undocumented APIs</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">Finding Undocumented APIs</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Leon Yin </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 24, 2023</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">June 15, 2023</p>
    </div>
  </div>
    
  </div>
  

<div>
  <div class="keywords">
    <div class="block-title">Keywords</div>
    <p>data collection, hidden api, undocumented api, web scraping, api</p>
  </div>
</div>

</header>


<div id="cell-1" class="cell" data-execution_count="2">
<div class="cell-output cell-output-display cell-output-markdown">
<p><a type="button" class="btn btn-outline-primary btn-sm" target="_blank" href="https://inspectelement.org/apis">📖 Read online</a> <a type="button" class="btn btn-outline-primary btn-sm" target="_blank" href="https://colab.research.google.com/github/yinleon/inspect-element/blob/main/apis.ipynb">🖥️ Interactive version</a> <a type="button" class="btn btn-outline-primary btn-sm" target="_blank" href="https://github.com/yinleon/inspect-element/blob/main/apis.ipynb">⚙️ GitHub</a> <a type="button" class="btn btn-outline-primary btn-sm" target="_self" href="#citation">🏛 Citation</a> <br></p>
</div>
</div>
<p>Most APIs are undocumented and hidden in plain sight.</p>
<p>Being able to find these APIs can provide a rich, reliable, and scalable method of building your own datasets.</p>
<p>Learn how to find them in the wild, and how they’ve been used in past investigations.</p>
<p>👉<a href="#tutorial">Click here to jump to the tutorial</a>.</p>
<section id="intro" class="level1">
<h1>Intro</h1>
<section id="what-is-an-a-p-i" class="level2">
<h2 class="anchored" data-anchor-id="what-is-an-a-p-i">What is an A-P-I?</h2>
<p>If you have tried to get a driver’s license or a travel visa, you have experienced bureaucracy at its finest– a series of lines, forms, credential-showing, and waiting.</p>
<p>Application Program Interfaces, or APIs, are digitized bureaucracy. You make a request, and then wait in a queue to be served by a server. However, instead of leaving with a driver’s license or a custom plate, what you’re waiting for is well-formatted data. As for making mistakes… well, you’ll get an automated rejection and zero sympathy.</p>
<p>Most APIs are undocumented and hidden in plain sight. There is no set terminology for these APIs, so for simplicity’s sake we’ll refer to them as “undocumented APIs”.</p>
<p>Some investigations are only possible after finding and reverse-engineering undocumented APIs. Our first case study illustrates this in detail, where my reporting partner Aaron Sankin and I discovered undocumented APIs out of necessity while reporting on YouTube.</p>
</section>
<section id="a-key-tool-for-investigations" class="level2">
<h2 class="anchored" data-anchor-id="a-key-tool-for-investigations">A key tool for investigations</h2>
<p>YouTube is the <a href="https://www.statista.com/topics/2019/youtube/">largest video-hosting platform</a> in the world, and plays a major role in the creator economy thanks to the YouTube Partner Program that shares ad revenue with eligible creators.</p>
<p>Advertising is central to YouTube, and major companies have boycotted the platform in the past in response to their ads appearing alongside extremist content. We wanted to better understand YouTube’s advertising system, especially how they treated hateful conspiracy theories, which at the time, seemed to thrive on the platform.</p>
<p>To start investigating this topic, we got acquainted with the Google Ads portal. Anyone can sign-up, and see all the tools that marketers can use to reach users across the Google adverse. YouTube has a special section of the ad portal, where marketers can target their ads based on user demographics and the content of videos.</p>
<p>We investigated a specific targeting tool that allows ad-buyers to use keyword searches to find videos and channels to place their ads on.</p>
<p><i>Read the <a href="https://themarkup.org/google-the-giant/2021/04/08/google-youtube-hate-videos-ad-keywords-blocklist-failures">investigation</a> along with its accompanying <a href="https://themarkup.org/google-the-giant/2021/04/08/how-we-discovered-googles-hate-blocklist-for-ad-placements-on-youtube">methodology</a></i>.</p>
<p>In an initial test, we found that searching for the racist “<a href="https://www.adl.org/resources/glossary-term/white-genocide">White genocide</a>” conspiracy theory returned no videos, but by simply removing spaces, we were shown relevant results.</p>
<figure class="figure">
<video src="https://mrkp-static-production.themarkup.org/graphics/youtube-hate-video/1617820765826/assets/white-genocide--compressed.mp4" autoplay="true" loop="true" width="100%">
</video>
<figcaption align="left" style="font-size:80%;">
Searching the Google Ads portal for YouTube videos related to a conspiracy theory, and circumventing blocking measures. Source: Google.com/The Markup
</figcaption>
</figure>
<p>This anecdotal test suggested that Google was using a keyword blocklist that hid results for certain search terms, but not others. We performed further tests and found that searching for swears and strings of gibberish also surfaced no results.</p>
<p>We wanted to verify if Google was using a keyword blocklist, and test how consistent that blocklist was with YouTube’s “advertiser friendly” <a href="https://support.google.com/youtube/answer/6162278?hl=en">guidelines</a>. Unfortunately, the portal did not make it possible to discern between a blocked keyword and one that may have been too obscure to return any results.</p>
<p>Our colleague Surya Mattu suggested using the web browser’s built-in <code>developer tools</code> to monitor <a href="https://doc.arcgis.com/en/appstudio/extend-apps/apinetworkrequest.htm">network requests</a> while we made searches in the portal. This proved to be a breakthrough that allowed us to isolate the API-endpoint being called during this process, reverse-engineer it to return results for any given keyword, and analyze the API’s response before its contents were displayed in the portal.</p>
<p>By looking closely at the API responses, we were able to identify clear structural differences based on Google’s verdict of the keyword. Blocked terms returned an empty JSON string <code>{}</code>, whereas obscure terms returned a JSON with labels but no results:</p>
<p><code>bbmdoushzyjntdotzaqeynrnfwfcgqeiayja</code></p>
<p>With the categorization scheme established, we could confirm search terms were being blocked (read about this in detail <a href="https://themarkup.org/google-the-giant/2021/04/08/how-we-discovered-googles-hate-blocklist-for-ad-placements-on-youtube#data-collection">here</a>). Moreover, with the API at our service, we could test any set of keywords, so we tested well-known <a href="https://themarkup.org/google-the-giant/2021/04/08/how-we-discovered-googles-hate-blocklist-for-ad-placements-on-youtube#sourcing-hate-keywords">hate terms</a> and phrases related to “racial justice and representation” that we asked <a href="https://themarkup.org/google-the-giant/2021/04/09/how-we-discovered-googles-social-justice-blocklist-for-youtube-ad-placements#sourcing-social-justice-keywords">independent advocacy groups</a> to send us.</p>
<p>After testing the two keyword lists, we saw a pattern of Google blocking racial justice terms (like “Black power”), while showing advertisers results for well-known hate terms (like “White power”).</p>
<figure class="figure">
<img src="assets/blocked-terms.png" style="width:90%" aria-label="Video thumbnails of videos suggested for &quot;white power&quot;, but no thumbnails for the blocked &quot;black power&quot; phrase." class="figure-img">
</figure>
<p>This was my first time finding and using an undocumented API for an investigation. Doing so revealed essential information that was not visible to everyday users, and it allowed us to perform systematic tests and bring receipts.</p>
<p>Before we dive deeper into how to find undocumented APIs, it’s important to note that some APIs are “official” and well-documented to the public. These APIs can also be used to great effect.</p>
</section>
<section id="documented-apis" class="level2">
<h2 class="anchored" data-anchor-id="documented-apis">Documented APIs</h2>
<p>Many businesses sell their services using APIs.</p>
<p>The benefit of documented APIs is self-explanatory, you know what you are going to get, and there are notes and examples to help developers use the tool as intended.</p>
<p>Some documented APIs are also free to use, making them a great tool for teaching and research. One such API that journalists frequent is the <a href="https://www.census.gov/data/developers/guidance/api-user-guide.html">Census Data API</a>, which we use to retrieve statistical survey data from across the United States. Unfortunately, free APIs can often disappear or have their access severely limited– as we’ve seen with Twitter (no longer free), YouTube (severely restricted), and Facebook (deprecated entirely).</p>
<section id="how-have-documented-apis-been-used" class="level3">
<h3 class="anchored" data-anchor-id="how-have-documented-apis-been-used">How have Documented APIs been used?</h3>
<ul>
<li><p><a href="https://gendershades.org/">Gender Shades</a> was an audit of three commercially-available facial recognition APIs used to automate gender classification (from Microsoft, IBM, and Face++). The authors created a benchmark image dataset of faces hand-labeled by gender and skin tone, and tested each facial recognition model by sending the benchmark dataset through each respective model’s API <span class="citation" data-cites="pmlr-v81-buolamwini18a">(<a href="references.html#ref-pmlr-v81-buolamwini18a" role="doc-biblioref">Buolamwini and Gebru 2018</a>)</span>. The authors found that many models had high error rates for female and Black faces, with the worst performance on Black female faces.</p></li>
<li><p>Google’s Perspective API was developed to filter out toxic comments for publishers such as <a href="https://www.nytimes.com/2017/06/13/insider/have-a-comment-leave-a-comment.htm">The New York Times</a>. Importantly, Perspective used “<a href="https://en.wikipedia.org/wiki/Training,_validation,_and_test_data_sets">training data</a>” sourced from human-labeled <a href="https://en.wikipedia.org/wiki/Artificial_intelligence_in_Wikimedia_projects">Wikipedia</a> edits. <a href="https://maartensap.com/pdfs/sap2019risk.pdf">An academic study</a> found racially biased classifications of Tweets. For example, the use of certain identifiers for minority groups would flag a comment as “toxic” <span class="citation" data-cites="sap-etal-2019-risk">(<a href="references.html#ref-sap-etal-2019-risk" role="doc-biblioref">Sap et al. 2019</a>)</span>. Because Google had released the API publicly, researchers could access and audit this technology directly through the API.</p></li>
</ul>
<p>Now, let’s get back to APIs that are undocumented and hidden.</p>
</section>
</section>
<section id="undocumented-apis" class="level2">
<h2 class="anchored" data-anchor-id="undocumented-apis">Undocumented APIs</h2>
<p>These are the unsung heroes making sure websites run, often times executing essential functions behind the scenes. Many of these functions are so mundane, you probably don’t even realize that something is happening.</p>
<p>If you spend time on social media platforms, you’ll find that the good times keep rolling, and you’ll never reach the end of the page. That is because “infinite scroll” is powered by an API that is called upon as you approach the bottom of the page to load more fun things to eat up your day.</p>
<p>Sometimes engineers find these API endpoints and build open source software to access public data programmatically. See <a href="https://instaloader.github.io/">Instaloader</a> (for Instagram) as an example.</p>
<p>Learning how to find and use these publicly available APIs can help you build evidence and test hypotheses that are otherwise unreachable due to lack of access.</p>
</section>
</section>
<section id="case-studies" class="level1">
<h1>Case Studies</h1>
<section id="how-have-undocumented-apis-been-used" class="level2">
<h2 class="anchored" data-anchor-id="how-have-undocumented-apis-been-used"><em>How have undocumented APIs been used?</em></h2>
<p>Journalists and researchers have used undocumented APIs to catalog Amazon Ring’s sprawling surveillance network <span class="citation" data-cites="calacci-2022 gizmodo-ring-2019">(<a href="references.html#ref-calacci-2022" role="doc-biblioref">Calacci, Shen, and Pentland 2022</a>; <a href="references.html#ref-gizmodo-ring-2019" role="doc-biblioref">Cameron and Mehrota 2019</a>)</span>, measure inequities in internet access using Facebook’s advertising ecosystem <span class="citation" data-cites="garcia-2018">(<a href="references.html#ref-garcia-2018" role="doc-biblioref">Garcia et al. 2018</a>)</span>, and parse complex government documents listing presidential appointees <span class="citation" data-cites="willis-plum">(<a href="references.html#ref-willis-plum" role="doc-biblioref">Willis 2013</a>)</span>.</p>
<p>Using undocumented APIs has three key strengths:</p>
<ol type="1">
<li><strong>Richness</strong>: APIs often contain information that is not visible on web pages.<br></li>
<li><strong>Reliability</strong>: APIs execute essential functions, so they don’t change often. This can make for a reliable data source over time.<br></li>
<li><strong>Scalability</strong>: You can collect more information in less time using this method compared to <a href="https://en.wikipedia.org/wiki/Headless_browser">headless browsers</a>, such as Selenium, Puppeteer, and Playwright (Not throwing shade– these tools have their purpose).</li>
</ol>
<p>Next we will cover three case studies, each of which is intended to highlight one of these benefits.</p>
</section>
<section id="case-study-on-richness-googles-blocklist-for-youtube-advertisers" class="level2">
<h2 class="anchored" data-anchor-id="case-study-on-richness-googles-blocklist-for-youtube-advertisers">Case study on richness: Google’s blocklist for YouTube advertisers</h2>
<p>I’m not going to rehash this case study, since we led with it in the <a href="#a-key-tool-for-investigations">introduction</a>, but…</p>
<p>Using undocumented APIs can reveal <strong>rich</strong> metadata. This includes hidden fields that are not displayed to everyday users of a website, as well as subtle changes to the structural in how data is returned.</p>
<p>Using this metadata produces receipts you can follow by deciphering the meaning of these hidden fields, finding traces left by missing data, and identifying patterns that are otherwise hidden from the surface (front-end) world.</p>
<p>Certainly this was the case with the YouTube investigation, and something that we’ll brush on again in the hands-on tutorial at the end of this section.</p>
</section>
<section id="case-study-on-reliability-amazon-branded-products" class="level2">
<h2 class="anchored" data-anchor-id="case-study-on-reliability-amazon-branded-products">Case study on reliability: Amazon branded products</h2>
<p>If you have ever scraped HTML from a website, you’ve likely found yourself with a broken scraper.</p>
<p>This occurs when class names, accessibility labels, text, or something else has changed and confused your scraper. In this sense, HTML scraping can be fragile and fickle, especially if your collecting data over a prolonged period of time.</p>
<p>A stark example is Facebook’s timeline, where you’ll find <a href="https://developer.mozilla.org/en-US/docs/Glossary/Element">elements</a> of the page are arbitrarily named, oddly-nested, and ever-changing.</p>
<p>Using undocumented APIs can often get you the same information with a higher success-rate. This is because these APIs interact with the same backend (fetching information before being rendered, named, and nestled neatly into a webpage), and are often essential to the operation of the website.</p>
<p>In the investigation “<a href="https://themarkup.org/amazons-advantage/2021/10/14/how-we-analyzed-amazons-treatment-of-its-brands-in-search-results">Amazon’s Advantage</a>”, Adrianne Jeffries and I found a <strong>reliable</strong> method of identifying Amazon brands and exclusive products. At the time, these products were not clearly labeled, most Americans we surveyed were unable to identify Amazon’s top brands, and no source of truth existed.</p>
<p>We developed a approach to identify these products as Amazon private label using a filter found in the user interface of Amazon’s website. The “Our brands” filter did a lot of heavy lifting in our investigation, and we found that it was powered by a undocumented API that listed all the Amazon branded products for a given search.</p>
<p>This method was key to our investigation, which required persistent data collection over a period of several months. To our surprise, the API continued to work after we went to Amazon for comments on our detailed methodology, after we published our investigation, and even after Amazon executives were accused of perjury by members of the U.S. Congress.</p>
<p>Usually the party gets shut down once you call the parents, but in this case it didn’t.</p>
<p>Because the API continued to work, we used it in a browser extension (<a href="https://themarkup.org/amazons-advantage/2021/11/29/introducing-amazon-brand-detector"><em>Amazon Brand Detector</em></a>) that we (including Ritu Ghiya and Jeff Crouse) built to highlight Amazon brands for shoppers around the globe. About half a year later, Amazon added an orange disclaimer of “Amazon brand” to their branded products, but the API and extension still work at the time of writing, more than a year later.</p>
<p>This case study emphasizes the reliability of using undocumented APIs, not only for collecting datasets, but for persistent accountability efforts.</p>
</section>
<section id="case-study-on-scalability-collecting-internet-plans" class="level2">
<h2 class="anchored" data-anchor-id="case-study-on-scalability-collecting-internet-plans">Case study on scalability: collecting Internet Plans</h2>
<p>In the investigation, “<a href="https://themarkup.org/show-your-work/2022/10/19/how-we-uncovered-disparities-in-internet-deals">Still Loading</a>” my reporting partner Aaron Sankin and I collected and analyzed over 1 million internet service plans across major cities in the United States.</p>
<p>We learned a technique from a trio of researchers from Princeton, that used the lookup tools found on the internet service providers’ websites to retrieve internet plans for a specific address <span class="citation" data-cites="princeton-2020">(<a href="references.html#ref-princeton-2020" role="doc-biblioref">Major, Teixeira, and Mayer 2020</a>)</span>.</p>
<p>However, doing this using a browser (as a real person would) is incredibly slow. Even with 10 automated browsers (see below) with unique IP addresses, it would have taken months to collect a representative sample of a single major American city.</p>
<figure class="figure">
<video width="100%" controls="" loop="">
<source src="assets/att-scraper-selenium.mp4" type="video/mp4">
</video>
<figcaption align="left" style="font-size:80%;">
Automating checking for internet plans from AT&amp;T using Selenium browser automation.
</figcaption>
</figure>
<p>Browser automation is bulky. Not only do you need to load every asset of a web page, there is also the compute resources necessary to spin up a browser. When you can get away without having to mock user interactions, or use rendered page elements, finding the underlying API(s) can be quicker and more eloquent.</p>
<p>Initially, the workflow for getting an internet plan seemed too complex to pull off using an API– there was user authentication that set a cookie, choosing an address from a list of suggestions, and adding an apartment number when prompted.</p>
<p>However, we were able to keep track of cookies using a <code>session</code> (read about this advanced topic <a href="https://requests.readthedocs.io/en/latest/user/advanced/#session-objects">here</a>), and speed things up by bundling the sequence of successive API calls into a function.</p>
<p>Not only was this function easier to write, but it was able to be written and executed <a href="https://en.wikipedia.org/wiki/Asynchrony_(computer_programming)">asynchronously</a>. Meaning we could request internet plans from many addresses at the same time.</p>
<p>This allowed us to collect AT&amp;T internet plans for a representative sample of 21 cities in two days, rather than two years.</p>
<p>Timely data collection is key. Solving this issue allowed us to be ambitious in the scope of our investigation, which <a href="https://themarkup.org/still-loading/2022/10/19/dollars-to-megabits-you-may-be-paying-400-times-as-much-as-your-neighbor-for-internet-service">ultimately found</a> that Internet pricing disparities were common for lower-income, least-White, and historically redlined areas.</p>
<p>When it comes to web scraping, undocumented APIs offer unmatched <strong>scalability</strong> to collect massive amounts of data. This is especially true when you orchestrate them with asynchronous and multi-threaded programming (another topic we plan to cover in a future section).</p>
<p>Although the process of finding undocumented APIs is not too complicated (as you’ll see in the tutorial), the chances of finding one that is helpful for your investigation or research are still quite low. Don’t be deterred, that just makes finding a useful one more special.</p>
</section>
</section>
<section id="tutorial" class="level1">
<h1>Tutorial</h1>
<section id="how-to-find-and-use-undocumented-apis" class="level2">
<h2 class="anchored" data-anchor-id="how-to-find-and-use-undocumented-apis"><em>How to find and use undocumented APIs</em></h2>
<p>In this exercise, you’ll learn to sniff out undocumented APIs using the web browser’s <code>developer tools</code> (shortened to dev tools), figure out how they work, test different inputs, and analyze API responses.</p>
<p>You can do most of this tutorial with zero coding, but it’ll hold you back from using APIs to their fullest.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Note that if you’re in a workshop setting: hitting the example API at the same time will get us all blocked from the website!</p>
</div>
</div>
</div>
<section id="first-open-the-developer-console." class="level3">
<h3 class="anchored" data-anchor-id="first-open-the-developer-console.">1. First open the developer console.</h3>
<p>See how on <a href="https://developer.chrome.com/docs/devtools/open/">Chrome</a> or <a href="https://developer.mozilla.org/en-US/docs/Learn/Common_questions/What_are_browser_developer_tools">Firefox</a> here.</p>
<p>In this tutorial, we’ll see how Amazon.com autocomplete search suggestions work.</p>
<p>One way to get to the dev tools it to right-click and “Inspect” an element on the page.</p>
<figure class="figure">
<img src="assets/inspect-panel.png" style="width:50%" class="figure-img">
<figcaption align="left" style="font-size:80%;">
Example of inspecting an element on a page using a right-click
</figcaption>
</figure>
<p>This will open the dev tools under the “Elements” tab, which is used to explore the source code of a page.</p>
<p>Page source code is useful because it reveals clues that are otherwise unseen by regular users. Often times, clues are in accessibility features known as ARIA elements.</p>
<p>However, this tutorial is not about source code… it’s about API requests that populate what we see on the page, and the hidden fields that we don’t see.</p>
<p>Let’s try this!</p>
<p>With dev tools open, go to Amazon.com, select the search bar on the website, and start typing a query (such as “spicy”).</p>
</section>
<section id="click-the-network-tab." class="level3">
<h3 class="anchored" data-anchor-id="click-the-network-tab.">2. Click the “Network” tab.</h3>
<p>This section of the dev tools is used to monitor network requests.</p>
<p><em>Background</em></p>
<p>Everything on a page is retrieved from some outside source, likely a server. This includes things like images embedded on the page, JavaScript code running in the background, and all the bits of “content” that populate the page before us.</p>
<p>Using the <code>Network</code> tab, we can find out how this information is requested from a server, and intercept the response before it is rendered on the page.</p>
<p>These responses are information-rich, and contain fields that don’t end up in the source code <em>or</em> in the user interface that most people encounter when they visit a site.</p>
<p>Further, we can reverse-engineer how this request is made, and use it to collect structured data at scale. This is the power of finding undocumented APIs.</p>
<p><em>Back to the console…</em></p>
<p>The <code>Network</code> tab can look pretty hectic at first. It has many uses, and a lot of information. We’ll cover some of the basics.</p>
<video width="100%" controls="" loop="">
<source src="assets/dev-console.mp4" type="video/mp4">
</video>
</section>
<section id="filter-requests-by-fetchxhr" class="level3">
<h3 class="anchored" data-anchor-id="filter-requests-by-fetchxhr">3. Filter requests by fetch/XHR</h3>
<p>This will reveal only API calls made to servers. This includes internal servers that are hosted by the website we’re inspecting, as well as external servers. The latter often includes <a href="https://themarkup.org/blacklight">third-party trackers</a> used in adtech, and verification services to authenticate user behavior.</p>
<video width="100%" controls="" loop="">
<source src="assets/filter-network.mp4" type="video/mp4">
</video>
<p>You might see quite a few network requests that were loaded onto the page. Look at “Domain” and “File” to narrow down where requests were sent, and whether the names are telling of the purpose of the request.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Pro tip:
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can “Filter URLs” using different properties (see how to do this for <a href="https://developer.chrome.com/docs/devtools/network/reference/#filter-by-property">Chrome</a> and <a href="https://firefox-source-docs.mozilla.org/devtools-user/network_monitor/request_list/index.html#filtering-requests">Firefox</a>).</p>
</div>
</div>
<p>In this example, notice that a request was sent to the “Domain” <code>completion.amazon.com</code>, using an API endpoint (in the “File” column) named <code>suggestions</code>. This is likely the API being called to populate autocompleted search suggestions on the Amazon marketplace. Reading “File” names can help determine each API’s function.</p>
<p>When clicking the network request, you’ll see “Headers”. Those are the <a href="https://developer.mozilla.org/en-US/docs/Glossary/Request_header">HTTP headers</a> that were sent along with the network request. This is not useful for us <em>just yet</em>, instead we want to see what data gets transferred as a result of the API call.</p>
<p>To do this, we’ll look at the request’s “Response” attributes.</p>
</section>
<section id="analyze-the-response" class="level3">
<h3 class="anchored" data-anchor-id="analyze-the-response">4. Analyze the response</h3>
<p>This might seem intimidating at first, but let me <em>key</em> you in on some tips. Responses are almost always JSON-formatted. JSON is made up of lists and <a href="https://en.wikipedia.org/wiki/Name%E2%80%93value_pair">key-value</a> pairs. This means the information is stored like a dictionary, with words and their corresponding definitions.</p>
<p>Looking at the JSON response, it looks like Amazon’s <code>completion.amazon.com/suggestions</code> API returns a list of “suggestions”. Each item in the list of suggestions has a “value”, in the example above that “value” is <code>spicy ramen</code>.</p>
<p><strong>Check your work</strong>: confirm this interpretation is correct by cross-referencing the API response with what a user would see on the website.</p>
<figure class="figure">
<img src="assets/spicy.png" width="50%" class="figure-img">
<figcaption align="left" style="font-size:80%;">
Amazon’s suggestions for “spicy”.
</figcaption>
</figure>
<p>Another check you can perform <code>CTRL+F</code> the JSON response for a unique string. This could be a string of text on the page (or something else) that serves as a unique tracer. Verifying its presence will help pinpoint the right API call.</p>
<p>Getting these steps down, is your one way ticket to spicy town, and you don’t need to code at all.</p>
<p>However, some rudimentary coding can help you figure out how to use the API for vast inputs to collect your own dataset.</p>
</section>
<section id="copy-as-curl" class="level3">
<h3 class="anchored" data-anchor-id="copy-as-curl">5. Copy as cURL</h3>
<p>If you find an HTTP request that returns a response with useful information you can start to reverse-engineer it. To do that, we can isolate it by right-clicking the HTTP request and selecting “copy as cURL”. (<a href="https://developer.ibm.com/articles/what-is-curl-command/">cURL</a> stands for client URL, and is a tool used to transfer data across networks.)</p>
<p><img src="assets/copy-curl.png" width="90%"></p>
</section>
<section id="curl-to-requests" class="level3">
<h3 class="anchored" data-anchor-id="curl-to-requests">6. Curl to requests</h3>
<p>We can use a site like <a href="https://curlconverter.com/">curlconverter.com</a> to convert the cURL we copied into a reusable API call. In this example, we use the default conversion to a Python <code>requests</code> script. You can do the same for any language and framework.</p>
<p>Here is what the converted cURL looks like after being converted to a Python request:</p>
<div id="cell-28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>cookies <span class="op">=</span> {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'aws-ubid-main'</span>: <span class="st">'836-8365128-6734270'</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'session-id-time'</span>: <span class="st">'2082787201l'</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ubid-main'</span>: <span class="st">'135-7086948-2591317'</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'aws-priv'</span>: <span class="st">'eyJ2IjoxLCJldSI6MCwic3QiOjB9'</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'aws-target-static-id'</span>: <span class="st">'1593060129944-225088'</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lc-main'</span>: <span class="st">'en_US'</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'x-main'</span>: <span class="st">'Oz3Tb5n2p0ic7OhF3cU5dc9B4ZR2gFjhKEsP4zikHHD3Gk2O7NpSmuShBxLFrhpZ'</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'at-main'</span>: <span class="st">'Atza|IwEBILB5ARQ_IgTCiBLam_XE2pyT76jXTbAXHOm2AJomLPmDgoJUJIIlUmyFeh_gChLHCycKjNlys-5CqqMabKieAzqSf607ChJsNevw-V06e7VKgcWjvoMaZRWlGiZ-c5wSJ-e4QzIWzAxTS1EI6sRUaRZRv-a0ZpOJQ-sHHB99006ytcrHhubdrXYPJRqEP5Q-_30JtESMpAkASoOs4vETSFp5BDBJfSWWETeotpIVXwA4NoC8E59bZb_5wHTW9cRBSWYGi1XL7CRl2xGbJaO2Gv3unuhGMB1tiq9iwxodSPBBTw'</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sess-at-main'</span>: <span class="st">'"PUq9PW1TbO9CTYhGMo7l1Dz+wedh40Ki8Z9rPC+1TSI="'</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sst-main'</span>: <span class="st">'Sst1|PQHsbeSFCMSY0X0_WgvTo5NUCaZkG2J9RPqWWy0fCpyWopJXgu6_drU_LstOdJB2cDmaVCXwkNpsF5yNPrBDj3Wtx-TC-AaYZn6WUdp8vNRPb6iYqxPAjRDnfK3pCnHqt19I0GoG7Bd1wnOxkAvnH0992IUq14kH6Ojm0J8noVPwMez0lltD-jxBwtDQ_EZYUkZG741RDVEojfziawJY9iKc-cLCnKmhi-ca1PPJnsimPV4lXRtMAGFbf9nMkKq4CbpkaRMdVtlPr20vF9eqg_V_-LY_V7S44WlO-_t_bFBnK8Q'</span>,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'i18n-prefs'</span>: <span class="st">'USD'</span>,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'session-token'</span>: <span class="st">'ptze73uznXExrMCSV9AklvNOKa1ND9F0rlQH2ioSM26Vr6hSheH8O4v4P8Lg3zuv7oDM+HZ+8f2TlyoPXUmPShprMXdvEpAQieXUw7+83PZOJvkkg1jwP0NiG0ZqksIYOr3Zuwt3omMcfCKRReWKxl5rGaDEM6AISpwI5aMDDCnA7fWbVO/QQYNxUZMifc599EZ5Fg3uGjCAhBlb6I7UO8ewRbXJ1bo9'</span>,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'session-id'</span>: <span class="st">'139-9925917-2023535'</span>,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'aws-userInfo-signed'</span>: <span class="st">'eyJ0eXAiOiJKV1MiLCJrZXlSZWdpb24iOiJ1cy1lYXN0LTEiLCJhbGciOiJFUzM4NCIsImtpZCI6ImFhNDFkZjRjLTMxMzgtNGVkOC04YmU5LWYyMzUzYzNkOTEzYiJ9..LWFZOJMDcYdu6od6Nk8TmhAFMGA9O98O4tIOsVlR7w5vAS_JgVixL8j75u6jTgjfWkdddhKqa5kgsXDmGNbjhzLIsD48ch1BUodlzxqeQfn0r8onIwLbUIHEnk6X-AJE'</span>,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'skin'</span>: <span class="st">'noskin'</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> {</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'User-Agent'</span>: <span class="st">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:100.0) Gecko/20100101 Firefox/100.0'</span>,</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Accept'</span>: <span class="st">'application/json, text/javascript, */*; q=0.01'</span>,</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Accept-Language'</span>: <span class="st">'en-US,en;q=0.5'</span>,</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 'Accept-Encoding': 'gzip, deflate, br',</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Origin'</span>: <span class="st">'https://www.amazon.com'</span>,</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Connection'</span>: <span class="st">'keep-alive'</span>,</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Referer'</span>: <span class="st">'https://www.amazon.com/'</span>,</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sec-Fetch-Dest'</span>: <span class="st">'empty'</span>,</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sec-Fetch-Mode'</span>: <span class="st">'cors'</span>,</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sec-Fetch-Site'</span>: <span class="st">'same-site'</span>,</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">'limit'</span>: <span class="st">'11'</span>,</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">'prefix'</span>: <span class="st">'spicy'</span>,</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">'suggestion-type'</span>: [</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">'WIDGET'</span>,</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">'KEYWORD'</span>,</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">'page-type'</span>: <span class="st">'Gateway'</span>,</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">'alias'</span>: <span class="st">'aps'</span>,</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">'site-variant'</span>: <span class="st">'desktop'</span>,</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">'version'</span>: <span class="st">'3'</span>,</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">'event'</span>: <span class="st">'onKeyPress'</span>,</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">'wc'</span>: <span class="st">''</span>,</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lop'</span>: <span class="st">'en_US'</span>,</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">'last-prefix'</span>: <span class="st">'</span><span class="ch">\0</span><span class="st">'</span>,</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">'avg-ks-time'</span>: <span class="st">'2486'</span>,</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">'fb'</span>: <span class="st">'1'</span>,</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">'session-id'</span>: <span class="st">'139-9925917-2023535'</span>,</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">'request-id'</span>: <span class="st">'SVMTJXRDBQ9T8M7BRGNJ'</span>,</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mid'</span>: <span class="st">'ATVPDKIKX0DER'</span>,</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">'plain-mid'</span>: <span class="st">'1'</span>,</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    <span class="st">'client-info'</span>: <span class="st">'amazon-search-ui'</span>,</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(<span class="st">'https://completion.amazon.com/api/2017/suggestions'</span>, </span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>                        params<span class="op">=</span>params, cookies<span class="op">=</span>cookies, headers<span class="op">=</span>headers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can run this Python code, as-is, and it should work.</p>
<p>Just a reminder that you can run this code interactively on <a href="https://colab.research.google.com/">Google Colab</a> by <a href="https://colab.research.google.com/github/yinleon/inspect-element/blob/main/apis.ipynb">copying this tutorial</a> (it’s written as a Jupyter Notebook), or running a “new notebook” and pasting the code in.</p>
<p>Press the little play button on the left to run the code. You should see something that looks similar to what you saw in the inspector.</p>
<div id="cell-30" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to see the response, run this cell:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>response.json()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="strip-it-down" class="level3">
<h3 class="anchored" data-anchor-id="strip-it-down">7. Strip it down</h3>
<p>You might be overwhelmed with the parameters that go into this API request. Like the response output, the inputs are formatted like a JSON, too. Start removing these parameters one-by-one.</p>
<p>Keep parameters for authentication, and also the input parameters that you can change for your own purposes. Notice that the example query of “spicy” stored in the <code>prefix</code> parameter.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Pro tip:
</div>
</div>
<div class="callout-body-container callout-body">
<p>Parameter values can expire, so periodically test the request and each parameter to assure you only keep the shelf-stable parts.</p>
</div>
</div>
<div id="cell-32" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'User-Agent'</span>: <span class="st">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:100.0) Gecko/20100101 Firefox/100.0'</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Accept'</span>: <span class="st">'application/json, text/javascript, */*; q=0.01'</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Accept-Language'</span>: <span class="st">'en-US,en;q=0.5'</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'prefix'</span>: <span class="st">'spicy'</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'suggestion-type'</span>: [</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'WIDGET'</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'KEYWORD'</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'alias'</span>: <span class="st">'aps'</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'plain-mid'</span>: <span class="st">'1'</span>,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(<span class="st">'https://completion.amazon.com/api/2017/suggestions'</span>, params<span class="op">=</span>params, headers<span class="op">=</span>headers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="recycle-and-reuse" class="level3">
<h3 class="anchored" data-anchor-id="recycle-and-reuse">8. Recycle and reuse</h3>
<p>With the stripped down request, try to submit a few— let’s say 10 or 20, requests with new parameters set by you.</p>
<p>For convenience, we can write the stripped down API call as a function that takes any <code>keyword</code> as input.</p>
<div id="cell-34" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> search_suggestions(keyword):</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Get autocompleted search suggestions for a `keyword` search on Amazon.com.</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    headers <span class="op">=</span> {</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'User-Agent'</span>: <span class="st">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:100.0) Gecko/20100101 Firefox/100.0'</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Accept'</span>: <span class="st">'application/json, text/javascript, */*; q=0.01'</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Accept-Language'</span>: <span class="st">'en-US,en;q=0.5'</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> {</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'prefix'</span>: keyword,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'suggestion-type'</span>: [</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">'WIDGET'</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'KEYWORD'</span>,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'alias'</span>: <span class="st">'aps'</span>,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'plain-mid'</span>: <span class="st">'1'</span>,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(<span class="st">'https://completion.amazon.com/api/2017/suggestions'</span>, </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                            params<span class="op">=</span>params, headers<span class="op">=</span>headers)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response.json()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this step the code gets refactored to make it repeatable and reusable, but it’s a bit of a jump if you’re not a coder. If that’s you, still try to read the code – you should be able to get a rough idea of what does what, and how it’s similar to the code you had in the last step.</p>
<p>Here we can set new input parameters in <code>keyword</code>, and make the an API call using each keyword. Try changing some of the code (eg. the keywords) and rerunning it to check your understanding.</p>
<div id="cell-37" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here are our inputs (what searches we'll get autocompleted)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>keywords <span class="op">=</span> [</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'cookie'</span>, <span class="st">'sock'</span>, <span class="st">'zelda'</span>, <span class="st">'12'</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we'll go through each input, get the suggestions, and then add the `suggestions` to a list.</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> []</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> keyword <span class="kw">in</span> keywords:</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    suggestions <span class="op">=</span> search_suggestions(keyword)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    suggestions[<span class="st">'search_word'</span>] <span class="op">=</span> keyword <span class="co"># keep track of the seed keyword</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">1</span>) <span class="co"># best practice to put some time between API calls.</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    data.extend(suggestions[<span class="st">'suggestions'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We saved the API responses in a list called <code>data</code>, and put them into a <a href="https://pandas.pydata.org/">Pandas</a> DataFrame to analyze.</p>
<div id="cell-39" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># show 5 random auto suggestions</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>df.sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">303</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">suggType</th>
<th data-quarto-table-cell-role="th">type</th>
<th data-quarto-table-cell-role="th">value</th>
<th data-quarto-table-cell-role="th">refTag</th>
<th data-quarto-table-cell-role="th">candidateSources</th>
<th data-quarto-table-cell-role="th">strategyId</th>
<th data-quarto-table-cell-role="th">prior</th>
<th data-quarto-table-cell-role="th">ghost</th>
<th data-quarto-table-cell-role="th">help</th>
<th data-quarto-table-cell-role="th">queryUnderstandingFeatures</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>4</td>
<td>KeywordSuggestion</td>
<td>KEYWORD</td>
<td>asmanex twisthaler 30 inhaler</td>
<td>nb_sb_ss_i_5_1</td>
<td>local</td>
<td>organic</td>
<td>0.0</td>
<td>False</td>
<td>False</td>
<td>[{'source': 'QU_TOOL', 'annotations': []}]</td>
</tr>
<tr class="even">
<td>13</td>
<td>KeywordSuggestion</td>
<td>KEYWORD</td>
<td>bathroom organizer</td>
<td>nb_sb_ss_i_4_1</td>
<td>local</td>
<td>organic</td>
<td>0.0</td>
<td>False</td>
<td>False</td>
<td>[{'source': 'QU_TOOL', 'annotations': []}]</td>
</tr>
<tr class="odd">
<td>19</td>
<td>KeywordSuggestion</td>
<td>KEYWORD</td>
<td>baby wipes</td>
<td>nb_sb_ss_i_10_1</td>
<td>local</td>
<td>organic</td>
<td>0.0</td>
<td>False</td>
<td>False</td>
<td>[{'source': 'QU_TOOL', 'annotations': []}]</td>
</tr>
<tr class="even">
<td>12</td>
<td>KeywordSuggestion</td>
<td>KEYWORD</td>
<td>baby registry search</td>
<td>nb_sb_ss_i_3_1</td>
<td>local</td>
<td>organic</td>
<td>0.0</td>
<td>False</td>
<td>False</td>
<td>[{'source': 'QU_TOOL', 'annotations': []}]</td>
</tr>
<tr class="odd">
<td>16</td>
<td>KeywordSuggestion</td>
<td>KEYWORD</td>
<td>b013xkha4m b08xzrxczm b07xxphqzk b09rwjblc7</td>
<td>nb_sb_ss_i_7_1</td>
<td>local</td>
<td>organic</td>
<td>0.0</td>
<td>False</td>
<td>False</td>
<td>[{'source': 'QU_TOOL', 'annotations': []}]</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>If you look at the columns, you might be flooded with more questions:</p>
<ul>
<li>Some terms may be <code>blackListed</code>, what does that mean and what words, if any, are <code>blackListed = True</code>?<br></li>
<li>Are some searches paid for, and not <code>organic</code>?<br></li>
<li>What is <code>ghost</code>?<br></li>
</ul>
<p>This metadata is only visible from the API, and can lead to new story ideas and directions to pursue.</p>
<p>Unfortunately, because this API is undocumented, asking these questions and figuring out what everything represents is difficult. Use your curiosity and look at many examples. The feature of the API is being able to make many queries at scale, which should help answer these questions. Reporting this out with sources is also essential in this process.</p>
</section>
</section>
<section id="do-it-yourself" class="level2">
<h2 class="anchored" data-anchor-id="do-it-yourself">Do it yourself</h2>
<p>Find an API in the wild, isolate it, strip it down, reverse-engineer it and analyze some of its results.</p>
<p>If a website has a search bar or a text box that queries a server or database, there’s a good chance that you can find an API.</p>
<p>Revisit the steps we outlined above, and apply them to a new website. If you aren’t a coder, try to get steps 1-6 (I believe in you!).</p>
<p>If you are a coder, try some of the advanced usage below.</p>
<section id="for-advanced-usage" class="level3">
<h3 class="anchored" data-anchor-id="for-advanced-usage">For advanced usage…</h3>
<ul>
<li>Handle errors for bad requests, rate limiting, and other issues that could arise.<br></li>
<li>Restructure the API response to better analyze (called “parsing” the data).<br></li>
<li>you can use <code>session</code> instead of pure requests. This is helpful if cookies and authentication are involved. Read more about that <a href="https://requests.readthedocs.io/en/latest/user/advanced/#session-objects">here</a>.<br></li>
<li>you can make a request asynchronous to speed up data collection (without overloading the site’s servers, of course).<br></li>
<li>Implement steps 6-onwards in another programming language.<br></li>
</ul>
</section>
</section>
<section id="predetermined-prompts" class="level2">
<h2 class="anchored" data-anchor-id="predetermined-prompts">Predetermined prompts</h2>
<p>Don’t know where to look? Here are some ideas:</p>
<ul>
<li>YouTube recommendations.<br></li>
<li><a href="https://themarkup.org/blacklight">Blacklight</a>’s API to find third-party trackers on a website.<br></li>
<li>Amtrak’s train statuses.</li>
</ul>
</section>
<section id="homework-assignment" class="level2">
<h2 class="anchored" data-anchor-id="homework-assignment">Homework assignment</h2>
<p><strong>Practice</strong>: Keep trying to find APIs in the wild. Think about the websites you frequent, topics that interest you, or stories you’re currently working on. You won’t always find an API, and that’s OK.</p>
<p><strong>Scoping</strong>: Determine how the API could be used to produce data to answer a reporting question or hypothesis. What will be your sample for a quick test, i.e.&nbsp;how many data points are enough to know if you have something?</p>
<p><strong>Reporting</strong>: Determine the meaning and significance of hidden fields that are returned.</p>
<p>Ultimately APIs are a tool, and data is useless without a purpose. Hopefully this worksheet helps you in your time of need.</p>
</section>
</section>
<section id="related-readings" class="level1">
<h1>Related readings</h1>
<p>More tutorials on the same subject:</p>
<ul>
<li><a href="https://scrapism.lav.io/scraping-xhr/">“Scraping XHR”</a> - Sam Lavigne<br></li>
<li><a href="https://www.gregreda.com/2015/02/15/web-scraping-finding-the-api/">“Web Scraping 201: finding the API”</a> - Greg Reda<br></li>
<li><a href="https://jvns.ca/blog/2022/03/10/how-to-use-undocumented-web-apis/">“How to use undocumented web APIs”</a> - Julia Evans</li>
</ul>
<p>Topical and timeless:</p>
<ul>
<li><a href="https://dfreelon.org/publications/2018_Computational_research_in_the_postAPI_age.pdf">“Computational research in the post-API age”</a> - Deen Freelon</li>
</ul>
<p>Notable investigations and audits using undocumented APIs:</p>
<ul>
<li><a href="https://gizmodo.com/ring-s-hidden-data-let-us-map-amazons-sprawling-home-su-1840312279">“Ring’s Hidden Data Let Us Map Amazon’s Sprawling Home Surveillance Network”</a> - Dell Cameron and Dhruv Mehrota<br></li>
<li>“<a href="https://www.theguardian.com/us-news/2022/aug/25/porch-piracy-package-thefts-doorstep-delivery">Porch piracy: are we overracting to package thefts from doorsteps?</a>” - Lam Thuy Vo<br></li>
<li>“<a href="https://site.dcalacci.net/papers/ring-cscw-2021.pdf">The Cop in Your Neighbor’s Doorbell</a>” - Dan Calacci et al.</li>
<li>“<a href="https://www.pnas.org/doi/full/10.1073/pnas.1717781115">Analyzing gender inequality through large-scale Facebook advertising data</a>” - David Garcia et al.<br></li>
<li>“<a href="https://source.opennews.org/articles/freeing-plum-book/">Freeing the Plum Book</a>” - Derek Willis<br></li>
</ul>
<p>Please reach out with more examples to add.</p>
<section id="artifacts" class="level2">
<h2 class="anchored" data-anchor-id="artifacts">Artifacts</h2>
<p>Slides from workshops can be found here:</p>
<p><a href="https://docs.google.com/presentation/d/1e1QoSNXv2m90lhhyUMSzUlMxXJD_Ar5DtC43PcpTcWU">2023-02-24 @ Tow Center Columbia</a><br> <a href="https://docs.google.com/presentation/d/1hWMqcBNfs9BbaVywMGJPf_BcR9PpVLlHPCGBsAzz-No/">2023-03-04 @ NICAR</a><br> <a href="https://docs.google.com/presentation/d/1-9rODLyxJawasNIn_rp9E_oHUOB1SUGCpAb8TbmyxKU/edit?usp=sharing">2023-06-12 @ FAccT</a><br> <a href="https://paper.dropbox.com/doc/Journocoders-June-2023-1t7nrjYNWoiPhK0sx8rH0">2023-06-14 @ Journocoders</a><br> <a href="https://docs.google.com/presentation/d/10_mWNwr_fsrX0r8e6xWhFruhdUZUbLEA9HqLI3HtEFg">2023-06-22 @ C+J DATAJ</a></p>
</section>
</section>
<section id="citation" class="level1">
<h1>Citation</h1>
<p>To cite this chapter, please use the following BibTex entry:</p>
<pre>@incollection{inspect2023browser,
  author    = {Yin, Leon},
  title     = {Finding Undocumented APIs},
  booktitle = {Inspect Element: A practitioner's guide to auditing algorithms and hypothesis-driven investigations},
  year      = {2023},
  editor    = {Yin, Leon and Sapiezynski, Piotr and Raji, Inioluwa Deborah},
  note      = {\url{https://inspectelement.org}}
}
</pre>
<section id="acknowledgements" class="level2">
<h2 class="anchored" data-anchor-id="acknowledgements">Acknowledgements</h2>
<p>Thank you Max Harlow for suggestions in making the tutorial easier to understand, and a well-compressed thank you to Simon Fondrie-Teitler for helping optimize this page.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-pmlr-v81-buolamwini18a" class="csl-entry" role="listitem">
Buolamwini, Joy, and Timnit Gebru. 2018. <span>“Gender Shades: Intersectional Accuracy Disparities in Commercial Gender Classification.”</span> In <em>Proceedings of the 1st Conference on Fairness, Accountability and Transparency</em>, edited by Sorelle A. Friedler and Christo Wilson, 81:77–91. Proceedings of Machine Learning Research. PMLR. <a href="https://proceedings.mlr.press/v81/buolamwini18a.html">https://proceedings.mlr.press/v81/buolamwini18a.html</a>.
</div>
<div id="ref-calacci-2022" class="csl-entry" role="listitem">
Calacci, Dan, Jeffrey J. Shen, and Alex Pentland. 2022. <span>“The Cop in Your Neighbor’s Doorbell: Amazon Ring and the Spread of Participatory Mass Surveillance.”</span> <em>Proc. ACM Hum.-Comput. Interact.</em> 6 (CSCW2). <a href="https://doi.org/10.1145/3555125">https://doi.org/10.1145/3555125</a>.
</div>
<div id="ref-gizmodo-ring-2019" class="csl-entry" role="listitem">
Cameron, Dell, and Dhruv Mehrota. 2019. <span>“Ring’s Hidden Data Let Us Map Amazon’s Sprawling Home Surveillance Network.”</span> <em>Gizmodo</em>, December. <a href="https://gizmodo.com/ring-s-hidden-data-let-us-map-amazons-sprawling-home-su-1840312279">https://gizmodo.com/ring-s-hidden-data-let-us-map-amazons-sprawling-home-su-1840312279</a>.
</div>
<div id="ref-garcia-2018" class="csl-entry" role="listitem">
Garcia, David, Yonas Mitike Kassa, Angel Cuevas, Manuel Cebrian, Esteban Moro, Iyad Rahwan, and Ruben Cuevas. 2018. <span>“<span class="nocase">Analyzing gender inequality through large-scale Facebook advertising data</span>.”</span> <em>Proceedings of the National Academy of Science</em> 115 (27): 6958–63. <a href="https://doi.org/10.1073/pnas.1717781115">https://doi.org/10.1073/pnas.1717781115</a>.
</div>
<div id="ref-princeton-2020" class="csl-entry" role="listitem">
Major, David, Ross Teixeira, and Jonathan Mayer. 2020. <span>“No WAN’s Land: Mapping u.s. Broadband Coverage with Millions of Address Queries to ISPs.”</span> In <em>Proceedings of the ACM Internet Measurement Conference</em>, 393–419. IMC ’20. New York, NY, USA: Association for Computing Machinery. <a href="https://doi.org/10.1145/3419394.3423652">https://doi.org/10.1145/3419394.3423652</a>.
</div>
<div id="ref-sap-etal-2019-risk" class="csl-entry" role="listitem">
Sap, Maarten, Dallas Card, Saadia Gabriel, Yejin Choi, and Noah A. Smith. 2019. <span>“The Risk of Racial Bias in Hate Speech Detection.”</span> In <em>Proceedings of the 57th Annual Meeting of the Association for Computational Linguistics</em>, 1668–78. Florence, Italy: Association for Computational Linguistics. <a href="https://doi.org/10.18653/v1/P19-1163">https://doi.org/10.18653/v1/P19-1163</a>.
</div>
<div id="ref-willis-plum" class="csl-entry" role="listitem">
Willis, Derek. 2013. <span>“Freeing the Plum Book.”</span> <em>Source</em>, April. <a href="https://source.opennews.org/articles/freeing-plum-book/">https://source.opennews.org/articles/freeing-plum-book/</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/inspectelement\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./build-your-own-datasets.html" class="pagination-link" aria-label="Build your own datasets">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Build your own datasets</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./browser_automation.html" class="pagination-link" aria-label="Browser automation">
        <span class="nav-page-text"><span class="chapter-title">Browser automation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.dev/yinleon/inspect-element/blob/main/apis.ipynb" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>